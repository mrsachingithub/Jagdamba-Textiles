{% extends "base.html" %}

{% block content %}
<div class="shop-container">
    <!-- Sidebar Filters -->
    <aside class="shop-sidebar">
        <h3 style="font-family: var(--font-serif); margin-top: 0;">Filters</h3>
        <hr style="border: none; border-bottom: 1px solid #eee; margin: 1rem 0;">

        <h4 style="margin-bottom: 0.5rem;">Categories</h4>
        <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="margin-bottom: 0.5rem;">
                <a href="{{ url_for('main.shop') }}"
                    class="filter-link {{ 'active' if not request.args.get('category_id') else '' }}">All</a>
            </li>
            {% for category in categories %}
            <li style="margin-bottom: 0.5rem;">
                <a href="{{ url_for('main.shop', category_id=category.id) }}"
                    class="filter-link {{ 'active' if request.args.get('category_id')|int == category.id else '' }}">
                    {{ category.name }}
                </a>
            </li>
            {% endfor %}
        </ul>
    </aside>

    <!-- Product Grid -->
    <div style="flex: 1;">
        <div
            style="margin-bottom: 2rem; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
            <h1 style="font-family: var(--font-serif); margin: 0;">Shop Fabrics</h1>
            <span>Showing {{ products|length }} results</span>
        </div>

        <div class="grid-card-container">
            {% for product in products %}
            <a href="{{ url_for('main.product_details', id=product.id) }}" class="product-card"
                style="display: block; text-decoration: none; color: inherit;">
                <!-- Product Image -->
                <div class="product-image-wrapper">
                    {% if product.variants.first() %}
                    <img src="{{ product.variants.first().image_url }}" alt="{{ product.name }}"
                        style="width: 100%; height: 100%; object-fit: cover;">
                    {% else %}
                    <span style="color: #888;">Image</span>
                    {% endif %}
                </div>
                <div style="padding: 1.5rem;">
                    <h3 class="product-title">
                        {{ product.name }}</h3>
                    <p style="color: #666; font-size: 0.9rem; margin: 0 0 0.5rem 0;">{{ product.width }} | {{
                        product.category.name }}</p>
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                        <span style="font-weight: 700; color: var(--accent-color);">â‚¹{{ product.base_price }}</span>
                        <span class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.8rem;">View</span>
                    </div>
                </div>
            </a>
            {% else %}
            <div style="grid-column: 1 / -1; text-align: center; padding: 4rem;">
                <p>No products found in this category.</p>
            </div>
            {% endfor %}
        </div>

        <!-- Pagination -->
        <div style="margin-top: 3rem; display: flex; justify-content: center; gap: 1rem;">
            {% if prev_url %}
            <a href="{{ url_for('main.shop', page=prev_url, category_id=request.args.get('category_id')) }}" class="btn"
                style="border: 1px solid #ddd;">&laquo; Previous</a>
            {% endif %}
            {% if next_url %}
            <a href="{{ url_for('main.shop', page=next_url, category_id=request.args.get('category_id')) }}" class="btn"
                style="border: 1px solid #ddd;">Next &raquo;</a>
            {% endif %}
        </div>
    </div>
</div>

<style>
    /* Shop Specific Styles - eventually move to style.css */
    .shop-container {
        display: flex;
        gap: 2rem;
    }

    .shop-sidebar {
        width: 250px;
        flex-shrink: 0;
        background: white;
        padding: 1.5rem;
        border-radius: 8px;
        height: fit-content;
    }

    .filter-link {
        color: inherit;
    }

    .filter-link.active {
        color: var(--accent-color);
    }

    .grid-card-container {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 2rem;
    }

    .product-image-wrapper {
        height: 200px;
        background: #f0f0f0;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
    }

    .product-title {
        margin: 0 0 0.5rem 0;
        font-size: 1.1rem;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }

    @media (max-width: 768px) {
        .shop-container {
            flex-direction: column;
        }

        .shop-sidebar {
            width: 100%;
            box-sizing: border-box;
        }
    }
</style>
{% endblock %}